{% extends "base.html" %}

{% block title %}Sistema de Gestão de Alunos{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <h1><i class="bi bi-mortarboard-fill me-3"></i>Sistema de Gestão de Alunos</h1>
    <p>Gerencie alunos, módulos e avaliações de forma simples e eficiente</p>
</div>

<!-- Navigation Tabs -->
<div class="card mb-4">
    <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" onclick="showTab('tab-add')" data-bs-toggle="tooltip" title="Cadastrar novo aluno">
                    <i class="bi bi-person-plus me-2"></i>Adicionar Aluno
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" onclick="showTab('tab-edit')" data-bs-toggle="tooltip" title="Editar dados de aluno existente">
                    <i class="bi bi-person-gear me-2"></i>Editar Aluno
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" onclick="showTab('tab-search')" data-bs-toggle="tooltip" title="Buscar alunos por nome ou matrícula">
                    <i class="bi bi-search me-2"></i>Pesquisar
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" onclick="showTab('tab-delete')" data-bs-toggle="tooltip" title="Excluir aluno do sistema">
                    <i class="bi bi-person-dash me-2"></i>Excluir Aluno
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" onclick="showTab('tab-create-module')" data-bs-toggle="tooltip" title="Criar novo módulo">
                    <i class="bi bi-folder-plus me-2"></i>Criar Módulo
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" onclick="showTab('tab-delete-module')" data-bs-toggle="tooltip" title="Excluir módulo existente">
                    <i class="bi bi-folder-minus me-2"></i>Excluir Módulo
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" onclick="showTab('tab-view-modules')" data-bs-toggle="tooltip" title="Visualizar módulos e gerenciar alunos">
                    <i class="bi bi-grid-3x3-gap me-2"></i>Módulos
                </button>
            </li>
        </ul>
        </div>

    <div class="card-body">
        <!-- Tab: Adicionar Aluno -->
        <div id="tab-add" class="tab-pane active">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h4 class="mb-4">
                        <i class="bi bi-person-plus text-primary me-2"></i>
                        Cadastrar Novo Aluno
                    </h4>
                    
                    <form class="needs-validation" novalidate>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="nomeNovo" class="form-label">
                                    <i class="bi bi-person me-1"></i>Nome Completo *
                                </label>
                                <input type="text" class="form-control" id="nomeNovo" placeholder="Digite o nome completo" required>
                                <div class="invalid-feedback">Por favor, informe o nome do aluno.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="numeroMatriculaNovo" class="form-label">
                                    <i class="bi bi-card-text me-1"></i>Número da Matrícula *
                                </label>
                                <input type="text" class="form-control" id="numeroMatriculaNovo" placeholder="Ex: 2024001" required>
                                <div class="invalid-feedback">Por favor, informe o número da matrícula.</div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="dataMatriculaNovo" class="form-label">
                                    <i class="bi bi-calendar me-1"></i>Data da Matrícula *
                                </label>
                                <input type="date" class="form-control" id="dataMatriculaNovo" required>
                                <div class="invalid-feedback">Por favor, informe a data da matrícula.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="atestadosNovo" class="form-label">
                                    <i class="bi bi-file-medical me-1"></i>Número de Atestados
                                </label>
                                <input type="number" class="form-control" id="atestadosNovo" placeholder="0" min="0">
                            </div>
            </div>
                        
                        <div class="mb-3">
                            <label for="encaminhamentoNovo" class="form-label">
                                <i class="bi bi-arrow-right-circle me-1"></i>Encaminhamento
                            </label>
                            <input type="text" class="form-control" id="encaminhamentoNovo" placeholder="Informações sobre encaminhamento">
            </div>
                        
                        <div class="mb-4">
                            <label for="obsNovo" class="form-label">
                                <i class="bi bi-chat-text me-1"></i>Observações
                            </label>
                            <textarea class="form-control" id="obsNovo" rows="3" placeholder="Observações adicionais sobre o aluno"></textarea>
            </div>
                        
                        <div class="d-grid">
                            <button type="button" onclick="adicionarAluno()" class="btn btn-success btn-lg">
                                <i class="bi bi-plus-circle me-2"></i>Cadastrar Aluno
                            </button>
            </div>
                    </form>
                    
                    <div id="mensagem" class="mt-3"></div>
            </div>
            </div>
        </div>

        <!-- Tab: Editar Aluno -->
        <div id="tab-edit" class="tab-pane">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h4 class="mb-4">
                        <i class="bi bi-person-gear text-warning me-2"></i>
                        Editar Dados do Aluno
                    </h4>
                    
                    <form class="needs-validation" novalidate>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="numeroMatriculaEditar" class="form-label">
                                    <i class="bi bi-card-text me-1"></i>Número da Matrícula *
                                </label>
                                <input type="text" class="form-control" id="numeroMatriculaEditar" placeholder="Digite a matrícula do aluno" required>
                                <div class="invalid-feedback">Por favor, informe o número da matrícula.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="nomeEditar" class="form-label">
                                    <i class="bi bi-person me-1"></i>Nome Completo
                                </label>
                                <input type="text" class="form-control" id="nomeEditar" placeholder="Novo nome do aluno">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="dataMatriculaEditar" class="form-label">
                                    <i class="bi bi-calendar me-1"></i>Data da Matrícula
                                </label>
                                <input type="date" class="form-control" id="dataMatriculaEditar">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="atestadosEditar" class="form-label">
                                    <i class="bi bi-file-medical me-1"></i>Número de Atestados
                                </label>
                                <input type="number" class="form-control" id="atestadosEditar" min="0">
                            </div>
            </div>
                        
                        <div class="mb-3">
                            <label for="encaminhamentoEditar" class="form-label">
                                <i class="bi bi-arrow-right-circle me-1"></i>Encaminhamento
                            </label>
                            <input type="text" class="form-control" id="encaminhamentoEditar" placeholder="Informações sobre encaminhamento">
            </div>
                        
                        <div class="mb-4">
                            <label for="obsEditar" class="form-label">
                                <i class="bi bi-chat-text me-1"></i>Observações
                            </label>
                            <textarea class="form-control" id="obsEditar" rows="3" placeholder="Observações adicionais"></textarea>
            </div>
                        
                        <div class="d-grid">
                            <button type="button" onclick="editarAluno()" class="btn btn-warning btn-lg">
                                <i class="bi bi-pencil-square me-2"></i>Atualizar Dados
                            </button>
            </div>
                    </form>
                    
                    <div id="mensagemEditar" class="mt-3"></div>
            </div>
            </div>
        </div>

        <!-- Tab: Pesquisar Aluno -->
        <div id="tab-search" class="tab-pane">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h4 class="mb-4">
                        <i class="bi bi-search text-info me-2"></i>
                        Pesquisar Aluno
                    </h4>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="numeroMatriculaPesquisa" class="form-label">
                                        <i class="bi bi-card-text me-1"></i>Número da Matrícula
                                    </label>
                                    <input type="text" class="form-control" id="numeroMatriculaPesquisa" placeholder="Digite a matrícula">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="nomePesquisa" class="form-label">
                                        <i class="bi bi-person me-1"></i>Nome do Aluno
                                    </label>
                                    <input type="text" class="form-control" id="nomePesquisa" placeholder="Digite o nome">
                                </div>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i>
                                <strong>Dica:</strong> Você pode pesquisar por matrícula ou nome. Deixe um campo em branco se não souber.
                            </div>
                            
                            <div class="d-grid">
                                <button onclick="pesquisarAluno()" class="btn btn-info btn-lg">
                                    <i class="bi bi-search me-2"></i>Buscar Aluno
                                </button>
                            </div>
                        </div>
            </div>
                    
                    <div id="resultadoPesquisa" class="mt-4"></div>
                    <div id="listaAlunos" class="mt-3"></div>
            </div>
            </div>
        </div>

        <!-- Tab: Excluir Aluno -->
        <div id="tab-delete" class="tab-pane">
            <div class="row">
                <div class="col-lg-6 mx-auto">
                    <h4 class="mb-4">
                        <i class="bi bi-person-dash text-danger me-2"></i>
                        Excluir Aluno
                    </h4>
                    
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Atenção:</strong> Esta ação é irreversível. Todos os dados do aluno serão perdidos permanentemente.
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="numeroMatriculaExcluir" class="form-label">
                                    <i class="bi bi-card-text me-1"></i>Número da Matrícula *
                                </label>
                                <input type="text" class="form-control" id="numeroMatriculaExcluir" placeholder="Digite a matrícula do aluno" required>
                            </div>
                            
                            <div class="d-grid">
                                <button onclick="excluirAluno()" class="btn btn-danger btn-lg">
                                    <i class="bi bi-trash me-2"></i>Excluir Aluno
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="mensagemExcluir" class="mt-3"></div>
                </div>
            </div>
        </div>

        <!-- Tab: Criar Módulo -->
        <div id="tab-create-module" class="tab-pane">
            <div class="row">
                <div class="col-lg-6 mx-auto">
                    <h4 class="mb-4">
                        <i class="bi bi-folder-plus text-success me-2"></i>
                        Criar Novo Módulo
                    </h4>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="nomeModulo" class="form-label">
                                    <i class="bi bi-folder me-1"></i>Nome do Módulo *
                                </label>
                                <input type="text" class="form-control" id="nomeModulo" placeholder="Ex: Matemática I, Português, etc." required>
                                <div class="form-text">O módulo será criado e todos os alunos existentes serão automaticamente adicionados.</div>
                            </div>
                            
                            <div class="d-grid">
                                <button onclick="criarModulo()" class="btn btn-success btn-lg">
                                    <i class="bi bi-plus-circle me-2"></i>Criar Módulo
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="mensagemModulo" class="mt-3"></div>
                </div>
            </div>
        </div>

        <!-- Tab: Excluir Módulo -->
        <div id="tab-delete-module" class="tab-pane">
            <div class="row">
                <div class="col-lg-6 mx-auto">
                    <h4 class="mb-4">
                        <i class="bi bi-folder-minus text-danger me-2"></i>
                        Excluir Módulo
                    </h4>
                    
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Atenção:</strong> Esta ação excluirá o módulo e todas as notas associadas a ele.
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="moduleNameExcluir" class="form-label">
                                    <i class="bi bi-folder me-1"></i>Nome do Módulo *
                                </label>
                                <input type="text" class="form-control" id="moduleNameExcluir" placeholder="Digite o nome exato do módulo" required>
                            </div>
                            
                            <div class="d-grid">
                                <button onclick="excluirModulo()" class="btn btn-danger btn-lg">
                                    <i class="bi bi-trash me-2"></i>Excluir Módulo
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="mensagemExcluirModulo" class="mt-3"></div>
                </div>
            </div>
        </div>

        <!-- Tab: Ver Módulos -->
        <div id="tab-view-modules" class="tab-pane">
            <h4 class="mb-4">
                <i class="bi bi-grid-3x3-gap text-primary me-2"></i>
                Módulos Cadastrados
            </h4>
            
            <div id="moduleList" class="mb-4"></div>
            <div id="mensagemListarModulo"></div>

            <!-- Container para lista de alunos do módulo -->
            <div id="studentListContainer" style="display: none;" class="mt-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-people me-2"></i>Alunos do Módulo
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="studentList"></div>
                    </div>
                </div>
            </div>
            
            <!-- Container para detalhes do aluno -->
            <div id="studentDetailsContainer" style="display: none;" class="mt-4">
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs">
                            <li class="nav-item">
                                <button class="nav-link active" onclick="showStudentTab('view-info')">
                                    <i class="bi bi-eye me-1"></i>Visualizar
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" onclick="showStudentTab('edit-info')">
                                    <i class="bi bi-pencil me-1"></i>Editar Notas
                                </button>
                            </li>
                        </ul>
                </div>
                    <div class="card-body">
                        <!-- Tab para Visualizar Informações -->
                <div id="view-info" class="student-tab-content">
                            <h5 class="mb-3">
                                <i class="bi bi-person-badge me-2"></i>Informações do Aluno
                            </h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong><i class="bi bi-person me-1"></i>Nome:</strong> <span id="detalhesNome" class="text-primary"></span></p>
                                    <p><strong><i class="bi bi-card-text me-1"></i>Matrícula:</strong> <span id="detalhesMatricula"></span></p>
                                    <p><strong><i class="bi bi-calendar-x me-1"></i>Faltas:</strong> <span id="detalhesFaltas" class="badge bg-secondary"></span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong><i class="bi bi-star me-1"></i>Nota do Tutor:</strong> <span id="detalhesNotaTutor" class="badge bg-info"></span></p>
                                    <p><strong><i class="bi bi-clipboard-check me-1"></i>Avaliação Regular:</strong> <span id="detalhesNotaAvaliacaoRegular" class="badge bg-primary"></span></p>
                                    <p><strong><i class="bi bi-arrow-repeat me-1"></i>Recuperação:</strong> <span id="detalhesNotaRecuperacao" class="badge bg-warning"></span></p>
                                    <p><strong><i class="bi bi-trophy me-1"></i>Nota Final:</strong> <span id="detalhesNotaFinal" class="badge bg-success"></span></p>
                                </div>
                            </div>
                </div>
            
                        <!-- Tab para Editar Informações -->
                    <div id="edit-info" class="student-tab-content" style="display: none;">
                            <h5 class="mb-3">
                                <i class="bi bi-pencil-square me-2"></i>Editar Avaliações
                            </h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="editFaltas" class="form-label">
                                        <i class="bi bi-calendar-x me-1"></i>Faltas
                                    </label>
                                    <input type="number" class="form-control" id="editFaltas" min="0" placeholder="Número de faltas">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="editNotaTutor" class="form-label">
                                        <i class="bi bi-star me-1"></i>Nota do Tutor
                                    </label>
                                    <input type="number" class="form-control" id="editNotaTutor" min="0" max="10" step="0.1" placeholder="0.0 - 10.0">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="editNotaAvaliacaoRegular" class="form-label">
                                        <i class="bi bi-clipboard-check me-1"></i>Avaliação Regular
                                    </label>
                                    <input type="number" class="form-control" id="editNotaAvaliacaoRegular" min="0" max="10" step="0.1" placeholder="0.0 - 10.0">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="editNotaRecuperacao" class="form-label">
                                        <i class="bi bi-arrow-repeat me-1"></i>Recuperação
                                    </label>
                                    <input type="number" class="form-control" id="editNotaRecuperacao" min="0" max="10" step="0.1" placeholder="0.0 - 10.0">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="editNotaFinal" class="form-label">
                                    <i class="bi bi-trophy me-1"></i>Nota Final
                                </label>
                                <input type="number" class="form-control" id="editNotaFinal" min="0" max="10" step="0.1" placeholder="0.0 - 10.0">
                            </div>
                            <div class="d-grid">
                                <button onclick="salvarEdicao()" class="btn btn-success btn-lg">
                                    <i class="bi bi-check-circle me-2"></i>Salvar Alterações
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}